steps:
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: 'gcloud'
    args: ['config', 'set', 'compute/zone', 'us-central1-a']

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: 'gcloud'
    args: ['container', 'clusters', 'get-credentials', 'my-cluster']
    env:
      - 'CLOUDSDK_CONTAINER_CLUSTER= my-cluster'

  # Build the Docker image for the Flask backend
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/backend:latest', './backend']
  
  # Push the backend image to Google Container Registry
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/backend:latest']
  
  # Build the Docker image for the Nginx frontend
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/frontend:latest', './frontend']
  
  # Push the frontend image to Google Container Registry
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/frontend:latest']
   
 # - name: 'gcr.io/cloud-builders/kubectl'
  #  args: ['set', 'image', 'deployment/frontend-ui', 'frontend-ui=gcr.io/$PROJECT_ID/frontend-ui:$SHORT_SHA', '--namespace=default']
   # env: ['CLOUDSDK_COMPUTE_ZONE=us-central1-1', 'CLOUDSDK_CONTAINER_CLUSTER=my-cluster']
  
  #- name: 'gcr.io/cloud-builders/kubectl'
  #  args: ['set', 'image', 'deployment/python-app', 'python-app=gcr.io/$PROJECT_ID/python-app:$SHORT_SHA', '--namespace=default']
  #  env: ['CLOUDSDK_COMPUTE_ZONE=your-zone', 'CLOUDSDK_CONTAINER_CLUSTER=your-cluster']
  
  # Apply the Kubernetes configuration files for the backend deployment
  - name: 'gcr.io/cloud-builders/kubectl'
    args: ['apply', '-f', 'manifest/backend-deployment.yaml']
    env: ['CLOUDSDK_COMPUTE_ZONE=us-central1-a', 'CLOUDSDK_CONTAINER_CLUSTER=my-cluster']
  # Apply the Kubernetes configuration files for the backend service
  - name: 'gcr.io/cloud-builders/kubectl'
    args: ['apply', '-f', 'manifest/backend-service.yaml']
    env: ['CLOUDSDK_COMPUTE_ZONE=us-central1-a', 'CLOUDSDK_CONTAINER_CLUSTER=my-cluster']
  # Apply the Kubernetes configuration files for the frontend deployment
  - name: 'gcr.io/cloud-builders/kubectl'
    args: ['apply', '-f', 'manifest/frontend-deployment.yaml']
    env: ['CLOUDSDK_COMPUTE_ZONE=us-central1-a', 'CLOUDSDK_CONTAINER_CLUSTER=my-cluster']
  # Apply the Kubernetes configuration files for the frontend service
  - name: 'gcr.io/cloud-builders/kubectl'
    args: ['apply', '-f', 'manifest/frontend-service.yaml']
    env: ['CLOUDSDK_COMPUTE_ZONE=us-central1-a', 'CLOUDSDK_CONTAINER_CLUSTER=my-cluster']
images:
  - 'gcr.io/$PROJECT_ID/backend:latest'
  - 'gcr.io/$PROJECT_ID/frontend:latest'

substitutions:
  _COMPUTE_ZONE: 'us-central1-a'
  _CLUSTER_NAME: 'my-cluster'
